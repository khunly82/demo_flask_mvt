{% extends "index.html" %}

{% block title %}Espace cin√©phile de {{ utilisateur|title }}{% endblock %}

{% block content %}

<h1>Bienvenue dans ton espace cin√©phile, {{ utilisateur|title }} !</h1>

{# === PARTIE 1 : PROFIL === #}
{% set total = films|length %}
{% set vus = films | selectattr("vu") | list | length %}
{% set pourcentage = (vus / total * 100) | round(2) if total > 0 else 0 %}

<fieldset>
	<legend>Mon Profil</legend>
	<p>Nombre total de films : <strong>{{ total }}</strong></p>
	<p>Nombre de films vus : <strong>{{ vus }}</strong> ({{ pourcentage }}%)</p>
	<p>
		Profil :
		{% if pourcentage >= 80 %}
		Cin√©phile averti
		{% elif pourcentage >= 50 %}
		Spectateur r√©gulier
		{% else %}
		Explorateur occasionnel
		{% endif %}
	</p>
</fieldset>

<hr>

{# === PARTIE 2 : BLOCS TH√âMATIQUES === #}
<h2>üéûÔ∏è Films √† d√©couvrir selon vos go√ªts</h2>

<h3>Blockbusters</h3>
{% for film in films %}
{% if not film.vu and (film.genre in ['Action', 'Thriller', 'Science-fiction']) %}
<div class="carte-film">
	<h4>{{ film.titre|upper }}</h4>
	<p>Genre : {{ film.genre }}</p>
	<p>Dur√©e : {{ film.duree }} min</p>
	<p>Note : {{ film.note }}</p>
	<button>Regarder maintenant</button>
</div>
{% endif %}
{% endfor %}

<h3>Films sensibles</h3>
{% for film in films %}
{% if not film.vu and (film.genre in ['Com√©die musicale', 'Drame', 'Romance']) %}
<div class="carte-film">
	<h4>{{ film.titre|upper }}</h4>
	<p>Genre : {{ film.genre }}</p>
	<p>Dur√©e : {{ film.duree }} min</p>
	<p>Note : {{ film.note }}</p>
	<button>Regarder maintenant</button>
</div>
{% endif %}
{% endfor %}

<h3>Autres films</h3>
{% for film in films %}
{% if not film.vu and (film.genre not in ['Action', 'Thriller', 'Science-fiction', 'Com√©die musicale', 'Drame',
'Romance']) %}
<div class="carte-film">
	<h4>{{ film.titre|upper }}</h4>
	<p>Genre : {{ film.genre }}</p>
	<p>Dur√©e : {{ film.duree }} min</p>
	<p>Note : {{ film.note }}</p>
	<button>Regarder maintenant</button>
</div>
{% endif %}
{% endfor %}

<hr>

{# === PARTIE 3 : RECOMMANDATION CIBL√âE === #}
<h2>Notre recommandation</h2>

{% set non_vus = films | selectattr("vu", "equalto", False) | list %}
{% set top = non_vus | max(attribute="note") if non_vus else None %}

{% if top %}
<div class="recommandation" style="border:1px solid #ccc; padding:10px;">
	<h3>{{ top.titre|title }}</h3>
	<p><strong>Note :</strong> {{ top.note }}</p>
	<p><strong>Genre :</strong> {{ top.genre }}</p>
	<p><strong>Dur√©e :</strong> {{ top.duree }} min</p>
	<p>Ce chef-d'≈ìuvre vous attend !</p>
</div>
{% else %}
<p>Vous avez d√©j√† vu tous les films du catalogue !</p>
{% endif %}

<hr>

{# === PARTIE 4 : DUR√âE TOTALE === #}
<h2>Temps total pass√© au cin√©ma</h2>
{% set total_duree = films | selectattr("vu") | map(attribute="duree") | sum %}
<p>Dur√©e totale des films vus : <strong>{{ total_duree }} minutes</strong></p>
<p>Soit environ <strong>{{ (total_duree / 60) | round(1) }}</strong> heures de visionnage üé•</p>

{% endblock %}